# Static Analysis: Crash Risk & Broken Flows Report

**Project:** HospoGo
**Date:** December 3, 2025
**Severity:** Critical (Proactive QA)

---

## 🚨 Critical Issues (Immediate Fix Required)

### 1. Syntax Error in Root Component (FIXED)
- **File:** `src/App.tsx`
- **Line:** 366
- **Status:** **FIXED** (Closing tag added).
- **Note:** This was blocking the entire application from rendering.

### 2. Broken Data Contracts (Undefined Properties)
The TypeScript audit revealed that several pages access properties that do not exist on the API response interfaces. These will lead to `undefined` values in critical logic (like User IDs for messaging), causing API failures or crashes.

#### A. Review Page
- **File:** `src/pages/review.tsx`
- **Line:** 42, 43
- **Issue:** Accesses `acceptedApp.userId`.
- **Root Cause:** `JobApplication` interface in `src/lib/api.ts` does NOT include `userId`.
- **Risk:** **CRASH.** `setRevieweeId(undefined)` will cause the Review Form to fail.

#### B. Manage Jobs Page
- **File:** `src/pages/manage-jobs.tsx`
- **Line:** 360, 365
- **Issue:** Accesses `application.userId`.
- **Root Cause:** `JobApplication` interface in `src/lib/api.ts` does NOT include `userId`.
- **Risk:** **BROKEN FEATURE.** "Message Candidate" button will fail to open a chat or crash.

#### C. My Applications Page
- **File:** `src/pages/my-applications.tsx`
- **Line:** 162
- **Issue:** Accesses `application.businessId`.
- **Root Cause:** `MyApplication` interface in `src/lib/api.ts` does NOT include `businessId`.
- **Risk:** **BROKEN FEATURE.** "Message Employer" will attempt to create a chat with an empty ID (`''`), failing the API call.

### 3. Missing Imports causing Reference Errors
- **File:** `src/pages/my-applications.tsx`
- **Line:** 161
- **Issue:** Calls `createConversation` but it is NOT imported.
- **Risk:** **RUNTIME CRASH.** Clicking "Message Employer" will throw `ReferenceError: createConversation is not defined`.

---

## ⚠️ High Risks (Data Integrity & UX)

### 1. Unsafe Access to "Possibly Undefined" Data
TypeScript Strict Check revealed these potential crash points where data is assumed to exist but might not.

- **Professional Dashboard (`src/pages/professional-dashboard.tsx`):**
  - `rate` (Line 96): Used in comparison without check.
  - `job.location` (Line 358, 528): Accessed as object (`.city`, `.state`) but typed as optional string/object.
  - `job.hubId` (Line 363, 583): Passed to `otherUserId` (expects string) but is optional.

- **Community Feed (`src/components/social/community-feed.tsx`):**
  - `post.authorName` (Line 63): `toLowerCase()` called on possibly undefined. **High Crash Risk.**
  - `post.likes` (Line 105): Math operation on possibly undefined.

### 2. "Blind" Navigation & State Dependencies
- **File:** `src/pages/job-details.tsx`
- **Line:** 16
- **Issue:** Relies on `id` from `useParams`. If undefined, the page relies on `useQuery`'s `enabled` flag to avoid fetching, but the UI might render in an "empty" state without explaining why.

### 3. Swallowed Errors in API Functions
- **File:** `src/lib/api.ts`
- **Line:** 270 (`fetchMyJobs`)
- **Issue:** `catch (e) { return []; }`
- **Risk:** **SILENT FAILURE.** API errors (500s) look like "No Data" to the user.

---

## ✅ Action Plan

1.  **IMMEDIATE:** Update `JobApplication` and `MyApplication` interfaces in `src/lib/api.ts` to match backend response (ensure `userId`, `businessId` are returned).
2.  **IMMEDIATE:** Add missing import `createConversation` to `src/pages/my-applications.tsx`.
3.  **IMMEDIATE:** Fix safe access patterns in `community-feed.tsx` (`post.authorName?.toLowerCase()`).
4.  **HIGH:** Refactor `fetchMyJobs` to propagate errors.
5.  **HIGH:** Add `userId` and `businessId` to the respective API interfaces and ensure the backend provides them.

---

*Generated by Cursor Static Analysis*
